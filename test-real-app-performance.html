<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Real App Performance Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .test-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }
        .test-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
            border-left: 4px solid #4CAF50;
        }
        .test-result {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
        }
        .success { border-left-color: #4CAF50; }
        .warning { border-left-color: #FF9800; }
        .error { border-left-color: #F44336; }
        .info { border-left-color: #2196F3; }
        button {
            background: linear-gradient(45deg, #4CAF50, #45a049);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        button:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
        }
        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #4CAF50;
        }
        .metric-label {
            font-size: 0.9em;
            opacity: 0.8;
        }
        .log-container {
            max-height: 300px;
            overflow-y: auto;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .optimization-check {
            display: flex;
            align-items: center;
            margin: 5px 0;
        }
        .optimization-check input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
    </style>
</head>
<body>
    <h1>üîç Real App Performance Test</h1>
    <p>Testing actual optimizations in the real App.js file</p>

    <div class="test-container">
        <h2>üîß Optimization Detection</h2>
        <div id="optimization-checks"></div>
    </div>

    <div class="test-container">
        <h2>üìä Performance Metrics</h2>
        <div class="metrics">
            <div class="metric-card">
                <div class="metric-value" id="file-size">0</div>
                <div class="metric-label">File Size (KB)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="optimization-count">0</div>
                <div class="metric-label">Optimizations Found</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="code-reduction">0</div>
                <div class="metric-label">Code Reduction (%)</div>
            </div>
            <div class="metric-card">
                <div class="metric-value" id="performance-score">0</div>
                <div class="metric-label">Performance Score</div>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>üß™ Real App Tests</h2>
        
        <div class="test-section">
            <h3>Phase 1: Code Consolidation Verification</h3>
            <button onclick="testRealDOMCaching()">Test Real DOM Caching</button>
            <button onclick="testRealParameterHandlers()">Test Real Parameter Handlers</button>
            <button onclick="testRealDebouncing()">Test Real Debouncing</button>
            <div id="real-phase1-results"></div>
        </div>

        <div class="test-section">
            <h3>Phase 2: Algorithm Optimization Verification</h3>
            <button onclick="testRealMorphingOptimization()">Test Real Morphing Optimization</button>
            <button onclick="testRealStateSubscriptions()">Test Real State Subscriptions</button>
            <button onclick="testRealForOfLoops()">Test Real For...Of Loops</button>
            <div id="real-phase2-results"></div>
        </div>

        <div class="test-section">
            <h3>Phase 3: Memory Management Verification</h3>
            <button onclick="testRealAbortControllers()">Test Real Abort Controllers</button>
            <button onclick="testRealEventListeners()">Test Real Event Listeners</button>
            <button onclick="testRealMemoryCleanup()">Test Real Memory Cleanup</button>
            <div id="real-phase3-results"></div>
        </div>

        <div class="test-section">
            <h3>üéØ Comprehensive Real App Test</h3>
            <button onclick="runRealComprehensiveTest()">Run All Real Tests</button>
            <button onclick="analyzeAppFile()">Analyze App.js File</button>
            <div id="real-comprehensive-results"></div>
        </div>
    </div>

    <div class="test-container">
        <h2>üìù Test Log</h2>
        <div class="log-container" id="real-test-log"></div>
    </div>

    <script>
        let appFileContent = '';
        let optimizationFeatures = {};

        function log(message, type = 'info') {
            const logContainer = document.getElementById('real-test-log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `test-result ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        function updateMetric(id, value) {
            const element = document.getElementById(id);
            if (element) {
                element.textContent = value;
            }
        }

        async function loadAppFile() {
            try {
                log('üìÅ Loading App.js file...', 'info');
                const response = await fetch('/src/core/App.js');
                if (!response.ok) {
                    throw new Error(`Failed to load App.js: ${response.statusText}`);
                }
                appFileContent = await response.text();
                log(`‚úÖ App.js loaded successfully (${(appFileContent.length / 1024).toFixed(1)}KB)`, 'success');
                return true;
            } catch (error) {
                log(`‚ùå Failed to load App.js: ${error.message}`, 'error');
                return false;
            }
        }

        function detectOptimizations() {
            log('üîç Detecting optimizations in App.js...', 'info');
            
            const optimizations = {
                // Phase 1: Code Consolidation
                parameterHandlers: appFileContent.includes('static PARAMETER_HANDLERS = new Map'),
                domCache: appFileContent.includes('domCache = new Map()'),
                getCachedElement: appFileContent.includes('getCachedElement(id)'),
                debounce: appFileContent.includes('debounce(func, wait)'),
                handleParameterUpdate: appFileContent.includes('handleParameterUpdate(target, value, source = \'midi\')'),
                
                // Phase 2: Algorithm Optimization
                morphingStateCache: appFileContent.includes('morphingStateCache'),
                getMorphingState: appFileContent.includes('getMorphingState()'),
                debouncedAudioUpdate: appFileContent.includes('debouncedAudioUpdate'),
                forOfLoops: appFileContent.includes('for (const') && appFileContent.includes('of'),
                
                // Phase 3: Memory Management
                abortControllers: appFileContent.includes('abortControllers = new Map()'),
                eventListeners: appFileContent.includes('eventListeners = []'),
                addTrackedEventListener: appFileContent.includes('addTrackedEventListener(element, event, handler)'),
                removeAllEventListeners: appFileContent.includes('removeAllEventListeners()'),
                cleanup: appFileContent.includes('cleanup()'),
                abortControllerUsage: appFileContent.includes('AbortController') && appFileContent.includes('signal: controller.signal'),
                
                // Additional optimizations
                unifiedParameterHandler: appFileContent.includes('PARAMETER_HANDLERS.get(target)'),
                morphingLogicConsolidation: appFileContent.includes('triggerRandomMorph()') && appFileContent.includes('getMorphingState()'),
                stateSubscriptionOptimization: appFileContent.includes('audioValues.forEach(key =>') && appFileContent.includes('debouncedAudioUpdate'),
                memoryLeakPrevention: appFileContent.includes('AbortError') && appFileContent.includes('finally')
            };

            optimizationFeatures = optimizations;
            
            const totalOptimizations = Object.values(optimizations).filter(Boolean).length;
            const totalPossible = Object.keys(optimizations).length;
            
            updateMetric('optimization-count', totalOptimizations);
            updateMetric('file-size', (appFileContent.length / 1024).toFixed(1));
            updateMetric('code-reduction', ((totalOptimizations / totalPossible) * 100).toFixed(1));
            updateMetric('performance-score', Math.round((totalOptimizations / totalPossible) * 100));

            log(`‚úÖ Detected ${totalOptimizations}/${totalPossible} optimizations`, 'success');
            
            return optimizations;
        }

        function displayOptimizationChecks() {
            const container = document.getElementById('optimization-checks');
            const optimizations = detectOptimizations();
            
            let html = '<h3>Phase 1: Code Consolidation</h3>';
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.parameterHandlers ? 'checked' : ''} disabled> Unified Parameter Handlers (PARAMETER_HANDLERS Map)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.domCache ? 'checked' : ''} disabled> DOM Caching (domCache Map)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.getCachedElement ? 'checked' : ''} disabled> Cached Element Retrieval (getCachedElement)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.debounce ? 'checked' : ''} disabled> Debouncing Utility (debounce function)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.handleParameterUpdate ? 'checked' : ''} disabled> Unified Parameter Handler (handleParameterUpdate)</div>`;
            
            html += '<h3>Phase 2: Algorithm Optimization</h3>';
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.morphingStateCache ? 'checked' : ''} disabled> Morphing State Cache (morphingStateCache)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.getMorphingState ? 'checked' : ''} disabled> Morphing Logic Consolidation (getMorphingState)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.debouncedAudioUpdate ? 'checked' : ''} disabled> Debounced Audio Updates (debouncedAudioUpdate)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.forOfLoops ? 'checked' : ''} disabled> For...Of Loop Optimization</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.stateSubscriptionOptimization ? 'checked' : ''} disabled> State Subscription Optimization</div>`;
            
            html += '<h3>Phase 3: Memory Management</h3>';
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.abortControllers ? 'checked' : ''} disabled> Abort Controllers (abortControllers Map)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.eventListeners ? 'checked' : ''} disabled> Event Listener Tracking (eventListeners array)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.addTrackedEventListener ? 'checked' : ''} disabled> Tracked Event Listeners (addTrackedEventListener)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.removeAllEventListeners ? 'checked' : ''} disabled> Event Listener Cleanup (removeAllEventListeners)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.cleanup ? 'checked' : ''} disabled> Comprehensive Cleanup (cleanup method)</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.abortControllerUsage ? 'checked' : ''} disabled> AbortController Usage in Fetch</div>`;
            html += `<div class="optimization-check"><input type="checkbox" ${optimizations.memoryLeakPrevention ? 'checked' : ''} disabled> Memory Leak Prevention (AbortError handling)</div>`;
            
            container.innerHTML = html;
        }

        // Real App Tests
        function testRealDOMCaching() {
            log('üß™ Testing Real DOM Caching...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const domCacheMatches = (appFileContent.match(/domCache/g) || []).length;
            const getCachedElementMatches = (appFileContent.match(/getCachedElement/g) || []).length;
            
            const result = {
                domCacheReferences: domCacheMatches,
                getCachedElementCalls: getCachedElementMatches,
                optimizationLevel: domCacheMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real DOM Caching Test: ${result.domCacheReferences} domCache references, ${result.getCachedElementCalls} getCachedElement calls`, 'success');
            
            document.getElementById('real-phase1-results').innerHTML = `
                <div class="test-result success">
                    <strong>Real DOM Caching Results:</strong><br>
                    DOM Cache References: ${result.domCacheReferences}<br>
                    getCachedElement Calls: ${result.getCachedElementCalls}<br>
                    Optimization Level: ${result.optimizationLevel}
                </div>
            `;
        }

        function testRealParameterHandlers() {
            log('üß™ Testing Real Parameter Handlers...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const parameterHandlersMatches = (appFileContent.match(/PARAMETER_HANDLERS/g) || []).length;
            const handleParameterUpdateMatches = (appFileContent.match(/handleParameterUpdate/g) || []).length;
            const switchStatementMatches = (appFileContent.match(/switch\s*\(/g) || []).length;
            
            const result = {
                parameterHandlersReferences: parameterHandlersMatches,
                handleParameterUpdateCalls: handleParameterUpdateMatches,
                remainingSwitchStatements: switchStatementMatches,
                consolidationLevel: parameterHandlersMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real Parameter Handlers Test: ${result.parameterHandlersReferences} PARAMETER_HANDLERS references, ${result.handleParameterUpdateCalls} handleParameterUpdate calls`, 'success');
            
            document.getElementById('real-phase1-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real Parameter Handlers Results:</strong><br>
                    PARAMETER_HANDLERS References: ${result.parameterHandlersReferences}<br>
                    handleParameterUpdate Calls: ${result.handleParameterUpdateCalls}<br>
                    Remaining Switch Statements: ${result.remainingSwitchStatements}<br>
                    Consolidation Level: ${result.consolidationLevel}
                </div>
            `;
        }

        function testRealDebouncing() {
            log('üß™ Testing Real Debouncing...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const debounceMatches = (appFileContent.match(/debounce/g) || []).length;
            const debouncedAudioUpdateMatches = (appFileContent.match(/debouncedAudioUpdate/g) || []).length;
            const setTimeoutMatches = (appFileContent.match(/setTimeout/g) || []).length;
            
            const result = {
                debounceReferences: debounceMatches,
                debouncedAudioUpdateReferences: debouncedAudioUpdateMatches,
                setTimeoutCalls: setTimeoutMatches,
                debouncingLevel: debounceMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real Debouncing Test: ${result.debounceReferences} debounce references, ${result.debouncedAudioUpdateReferences} debouncedAudioUpdate references`, 'success');
            
            document.getElementById('real-phase1-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real Debouncing Results:</strong><br>
                    Debounce References: ${result.debounceReferences}<br>
                    Debounced Audio Update References: ${result.debouncedAudioUpdateReferences}<br>
                    setTimeout Calls: ${result.setTimeoutCalls}<br>
                    Debouncing Level: ${result.debouncingLevel}
                </div>
            `;
        }

        function testRealMorphingOptimization() {
            log('üß™ Testing Real Morphing Optimization...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const morphingStateCacheMatches = (appFileContent.match(/morphingStateCache/g) || []).length;
            const getMorphingStateMatches = (appFileContent.match(/getMorphingState/g) || []).length;
            const triggerRandomMorphMatches = (appFileContent.match(/triggerRandomMorph/g) || []).length;
            const forOfLoopMatches = (appFileContent.match(/for\s*\(\s*const/g) || []).length;
            
            const result = {
                morphingStateCacheReferences: morphingStateCacheMatches,
                getMorphingStateCalls: getMorphingStateMatches,
                triggerRandomMorphCalls: triggerRandomMorphMatches,
                forOfLoops: forOfLoopMatches,
                optimizationLevel: morphingStateCacheMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real Morphing Optimization Test: ${result.morphingStateCacheReferences} morphingStateCache references, ${result.getMorphingStateCalls} getMorphingState calls`, 'success');
            
            document.getElementById('real-phase2-results').innerHTML = `
                <div class="test-result success">
                    <strong>Real Morphing Optimization Results:</strong><br>
                    Morphing State Cache References: ${result.morphingStateCacheReferences}<br>
                    getMorphingState Calls: ${result.getMorphingStateCalls}<br>
                    triggerRandomMorph Calls: ${result.triggerRandomMorphCalls}<br>
                    For...Of Loops: ${result.forOfLoops}<br>
                    Optimization Level: ${result.optimizationLevel}
                </div>
            `;
        }

        function testRealStateSubscriptions() {
            log('üß™ Testing Real State Subscriptions...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const stateSubscribeMatches = (appFileContent.match(/state\.subscribe/g) || []).length;
            const debouncedAudioUpdateMatches = (appFileContent.match(/debouncedAudioUpdate/g) || []).length;
            const audioValuesMatches = (appFileContent.match(/audioValues\.forEach/g) || []).length;
            
            const result = {
                stateSubscribeCalls: stateSubscribeMatches,
                debouncedAudioUpdateReferences: debouncedAudioUpdateMatches,
                audioValuesForEachCalls: audioValuesMatches,
                optimizationLevel: debouncedAudioUpdateMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real State Subscriptions Test: ${result.stateSubscribeCalls} state.subscribe calls, ${result.debouncedAudioUpdateReferences} debouncedAudioUpdate references`, 'success');
            
            document.getElementById('real-phase2-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real State Subscriptions Results:</strong><br>
                    State Subscribe Calls: ${result.stateSubscribeCalls}<br>
                    Debounced Audio Update References: ${result.debouncedAudioUpdateReferences}<br>
                    Audio Values ForEach Calls: ${result.audioValuesForEachCalls}<br>
                    Optimization Level: ${result.optimizationLevel}
                </div>
            `;
        }

        function testRealForOfLoops() {
            log('üß™ Testing Real For...Of Loops...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const forOfMatches = (appFileContent.match(/for\s*\(\s*const.*\s+of\s+/g) || []).length;
            const forEachMatches = (appFileContent.match(/\.forEach\(/g) || []).length;
            const forLoopMatches = (appFileContent.match(/for\s*\(\s*let/g) || []).length;
            
            const result = {
                forOfLoops: forOfMatches,
                forEachLoops: forEachMatches,
                traditionalForLoops: forLoopMatches,
                optimizationRatio: forOfMatches > 0 ? ((forOfMatches / (forOfMatches + forEachMatches)) * 100).toFixed(1) : '0'
            };

            log(`‚úÖ Real For...Of Loops Test: ${result.forOfLoops} for...of loops, ${result.forEachLoops} forEach loops`, 'success');
            
            document.getElementById('real-phase2-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real For...Of Loops Results:</strong><br>
                    For...Of Loops: ${result.forOfLoops}<br>
                    ForEach Loops: ${result.forEachLoops}<br>
                    Traditional For Loops: ${result.traditionalForLoops}<br>
                    Optimization Ratio: ${result.optimizationRatio}%
                </div>
            `;
        }

        function testRealAbortControllers() {
            log('üß™ Testing Real Abort Controllers...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const abortControllerMatches = (appFileContent.match(/AbortController/g) || []).length;
            const signalMatches = (appFileContent.match(/signal:\s*controller\.signal/g) || []).length;
            const abortErrorMatches = (appFileContent.match(/AbortError/g) || []).length;
            const fetchMatches = (appFileContent.match(/fetch\(/g) || []).length;
            
            const result = {
                abortControllerReferences: abortControllerMatches,
                signalUsage: signalMatches,
                abortErrorHandling: abortErrorMatches,
                fetchCalls: fetchMatches,
                coveragePercentage: fetchMatches > 0 ? ((signalMatches / fetchMatches) * 100).toFixed(1) : '0'
            };

            log(`‚úÖ Real Abort Controllers Test: ${result.abortControllerReferences} AbortController references, ${result.signalUsage} signal usages`, 'success');
            
            document.getElementById('real-phase3-results').innerHTML = `
                <div class="test-result success">
                    <strong>Real Abort Controllers Results:</strong><br>
                    AbortController References: ${result.abortControllerReferences}<br>
                    Signal Usage: ${result.signalUsage}<br>
                    AbortError Handling: ${result.abortErrorHandling}<br>
                    Fetch Calls: ${result.fetchCalls}<br>
                    Coverage: ${result.coveragePercentage}%
                </div>
            `;
        }

        function testRealEventListeners() {
            log('üß™ Testing Real Event Listeners...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const eventListenersMatches = (appFileContent.match(/eventListeners/g) || []).length;
            const addTrackedEventListenerMatches = (appFileContent.match(/addTrackedEventListener/g) || []).length;
            const removeAllEventListenersMatches = (appFileContent.match(/removeAllEventListeners/g) || []).length;
            const addEventListenerMatches = (appFileContent.match(/addEventListener/g) || []).length;
            
            const result = {
                eventListenersReferences: eventListenersMatches,
                addTrackedEventListenerCalls: addTrackedEventListenerMatches,
                removeAllEventListenersCalls: removeAllEventListenersMatches,
                totalAddEventListenerCalls: addEventListenerMatches,
                trackingRatio: addEventListenerMatches > 0 ? ((addTrackedEventListenerMatches / addEventListenerMatches) * 100).toFixed(1) : '0'
            };

            log(`‚úÖ Real Event Listeners Test: ${result.eventListenersReferences} eventListeners references, ${result.addTrackedEventListenerCalls} addTrackedEventListener calls`, 'success');
            
            document.getElementById('real-phase3-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real Event Listeners Results:</strong><br>
                    Event Listeners References: ${result.eventListenersReferences}<br>
                    Add Tracked Event Listener Calls: ${result.addTrackedEventListenerCalls}<br>
                    Remove All Event Listeners Calls: ${result.removeAllEventListenersCalls}<br>
                    Total AddEventListener Calls: ${result.totalAddEventListenerCalls}<br>
                    Tracking Ratio: ${result.trackingRatio}%
                </div>
            `;
        }

        function testRealMemoryCleanup() {
            log('üß™ Testing Real Memory Cleanup...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const cleanupMatches = (appFileContent.match(/cleanup\(\)/g) || []).length;
            const finallyMatches = (appFileContent.match(/finally/g) || []).length;
            const clearMatches = (appFileContent.match(/\.clear\(\)/g) || []).length;
            const deleteMatches = (appFileContent.match(/\.delete\(/g) || []).length;
            
            const result = {
                cleanupMethodCalls: cleanupMatches,
                finallyBlocks: finallyMatches,
                clearCalls: clearMatches,
                deleteCalls: deleteMatches,
                cleanupLevel: cleanupMatches > 0 ? 'High' : 'None'
            };

            log(`‚úÖ Real Memory Cleanup Test: ${result.cleanupMethodCalls} cleanup calls, ${result.finallyBlocks} finally blocks`, 'success');
            
            document.getElementById('real-phase3-results').innerHTML += `
                <div class="test-result success">
                    <strong>Real Memory Cleanup Results:</strong><br>
                    Cleanup Method Calls: ${result.cleanupMethodCalls}<br>
                    Finally Blocks: ${result.finallyBlocks}<br>
                    Clear Calls: ${result.clearCalls}<br>
                    Delete Calls: ${result.deleteCalls}<br>
                    Cleanup Level: ${result.cleanupLevel}
                </div>
            `;
        }

        function runRealComprehensiveTest() {
            log('üöÄ Starting Real Comprehensive Performance Test...', 'info');
            
            const tests = [
                testRealDOMCaching,
                testRealParameterHandlers,
                testRealDebouncing,
                testRealMorphingOptimization,
                testRealStateSubscriptions,
                testRealForOfLoops,
                testRealAbortControllers,
                testRealEventListeners,
                testRealMemoryCleanup
            ];
            
            let currentTest = 0;
            
            function runNextTest() {
                if (currentTest < tests.length) {
                    log(`Running real test ${currentTest + 1}/${tests.length}...`, 'info');
                    tests[currentTest]();
                    currentTest++;
                    setTimeout(runNextTest, 300);
                } else {
                    log('üéâ All real tests completed!', 'success');
                    generateRealSummary();
                }
            }
            
            runNextTest();
        }

        function analyzeAppFile() {
            log('üìä Analyzing App.js file...', 'info');
            
            if (!appFileContent) {
                log('‚ùå App.js not loaded. Please load the file first.', 'error');
                return;
            }

            const lines = appFileContent.split('\n');
            const totalLines = lines.length;
            const emptyLines = lines.filter(line => line.trim() === '').length;
            const commentLines = lines.filter(line => line.trim().startsWith('//')).length;
            const codeLines = totalLines - emptyLines - commentLines;
            
            const functionMatches = (appFileContent.match(/function\s+\w+|const\s+\w+\s*=\s*\(|async\s+\w+\s*\(/g) || []).length;
            const classMatches = (appFileContent.match(/class\s+\w+/g) || []).length;
            const importMatches = (appFileContent.match(/import\s+/g) || []).length;
            const exportMatches = (appFileContent.match(/export\s+/g) || []).length;
            
            const result = {
                totalLines,
                codeLines,
                commentLines,
                emptyLines,
                functions: functionMatches,
                classes: classMatches,
                imports: importMatches,
                exports: exportMatches,
                codeDensity: ((codeLines / totalLines) * 100).toFixed(1)
            };

            log(`‚úÖ App.js Analysis Complete: ${result.totalLines} total lines, ${result.codeLines} code lines`, 'success');
            
            document.getElementById('real-comprehensive-results').innerHTML = `
                <div class="test-result info">
                    <strong>App.js File Analysis:</strong><br>
                    Total Lines: ${result.totalLines}<br>
                    Code Lines: ${result.codeLines}<br>
                    Comment Lines: ${result.commentLines}<br>
                    Empty Lines: ${result.emptyLines}<br>
                    Functions: ${result.functions}<br>
                    Classes: ${result.classes}<br>
                    Imports: ${result.imports}<br>
                    Exports: ${result.exports}<br>
                    Code Density: ${result.codeDensity}%
                </div>
            `;
        }

        function generateRealSummary() {
            const totalOptimizations = Object.values(optimizationFeatures).filter(Boolean).length;
            const totalPossible = Object.keys(optimizationFeatures).length;
            const optimizationPercentage = ((totalOptimizations / totalPossible) * 100).toFixed(1);
            
            const summary = `
                <div class="test-result info">
                    <h3>üìä Real App Performance Summary</h3>
                    <p><strong>Optimization Coverage:</strong> ${totalOptimizations}/${totalPossible} (${optimizationPercentage}%)</p>
                    <p><strong>Phase 1 - Code Consolidation:</strong> ${optimizationFeatures.parameterHandlers && optimizationFeatures.domCache ? '‚úÖ' : '‚ùå'} DOM caching, parameter handlers, debouncing</p>
                    <p><strong>Phase 2 - Algorithm Optimization:</strong> ${optimizationFeatures.morphingStateCache && optimizationFeatures.debouncedAudioUpdate ? '‚úÖ' : '‚ùå'} Morphing cache, state subscriptions, for...of loops</p>
                    <p><strong>Phase 3 - Memory Management:</strong> ${optimizationFeatures.abortControllers && optimizationFeatures.eventListeners ? '‚úÖ' : '‚ùå'} Abort controllers, event listeners, memory cleanup</p>
                    <p><strong>File Size:</strong> ${(appFileContent.length / 1024).toFixed(1)}KB</p>
                    <p><strong>Performance Score:</strong> ${Math.round((totalOptimizations / totalPossible) * 100)}/100</p>
                </div>
            `;
            
            document.getElementById('real-comprehensive-results').innerHTML = summary;
        }

        // Initialize
        window.addEventListener('load', async () => {
            log('üöÄ Real App Performance Test Suite Initialized', 'success');
            
            // Load App.js file
            const loaded = await loadAppFile();
            if (loaded) {
                displayOptimizationChecks();
                log('‚úÖ Ready to run real app performance tests', 'success');
            } else {
                log('‚ùå Failed to load App.js. Some tests may not work.', 'error');
            }
        });
    </script>
</body>
</html> 